<div class="row-fluid">
    <div class="col-md-3">
        <h1>Manage Products</h1>
    </div>
    <div class="col-md-offset-11">
        <a class="btn btn-success" id="spacing_add" href="/products/new">Add product</a>
    </div>
</div>
<div id='prodTable'>
</div>

<script>
    function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');

        $(document).on('change', '#first_name', function(e){
            console.log('GGGFGGGG')
        })

        $(document).on('click', '#update', function(e){
            e.preventDefault()
            
            editurl='/products/edit/'+$(this).attr('info')+'/process';
            var correct='#edit' + $(this).attr('info')
            $.ajax({
                    url:editurl,
                    method:'post',
                    headers:{'X-CSRFToken': csrftoken},
                    data:{'name': $('#name').val(), 'description': $('#description').val(), 'price':$('#price').val(), 'category':$('#category').val(), 'newcategory':$('#newcategory').val()},
                    success: function(res){
                        $('#prodTable').html(res)
                        $(correct).modal('hide');
                        $('body').removeClass('modal-open');
                        $('.modal-backdrop').remove();
                    }
                })
            var correct='#edit' + $(this).attr('info')
            $(correct).modal('toggle')
        })

        $(document).on('click', '#delete', function(e){
            e.preventDefault()
            
            editurl='/products/delete/'+$(this).attr('info');
            var correct='#confirm' + $(this).attr('info')
            $.ajax({
                    url:editurl,
                    method:'post',
                    headers:{'X-CSRFToken': csrftoken},
                    data:{'name': $('#name').val(), 'description': $('#description').val(), 'price':$('#price').val(), 'category':$('#category').val(), 'newcategory':$('#newcategory').val()},
                    success: function(res){
                        $('#prodTable').html(res)
                        $(correct).modal('hide');
                        $('body').removeClass('modal-open');
                        $('.modal-backdrop').remove();
                    }
                })
            var correct='#confirm' + $(this).attr('info')
            $(correct).modal('toggle')
        })
    $(document).on('click', '.pagination>li>a', function(e){
            e.preventDefault();
            $.ajax({
                url:$(this).attr('href'),
                method: 'get',
                success: function(res){
                    $('#prodTable').html(res);
                }
            })
        })

    $.ajax({
            url:'/dashboard/products/1',
            // method: 'get',
            success: function(res){
                $('#prodTable').html(res);
            }
        })
    
</script>